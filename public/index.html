<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—Ä–∞—Ñ–∏–∫ –°—É–º–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –£—á–µ—Ç–∞ –†–∞–±–æ—á–µ–≥–æ –í—Ä–µ–º–µ–Ω–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/locales/ru.global.min.js"></script>
    <style>
        :root {
            --primary-color: #1e40af;
            --primary-hover: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --background-color: #f8fafc;
            --surface-color: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --border-radius: 8px;
            --transition: all 0.2s ease-in-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 14px;
        }

        /* Header */
        .header {
            background: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 24px;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        /* Main Layout */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 24px;
            padding: 24px;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            height: fit-content;
            position: sticky;
            top: 104px;
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Content Area */
        .content {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .content-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .month-navigation {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-button {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            color: var(--text-secondary);
        }

        .nav-button:hover {
            background: var(--background-color);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .current-month {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 200px;
            text-align: center;
        }

        .view-tabs {
            display: flex;
            background: var(--background-color);
            border-radius: 6px;
            padding: 4px;
        }

        .tab {
            padding: 8px 16px;
            border-radius: 4px;
            background: transparent;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .tab.active {
            background: var(--surface-color);
            color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }

        .content-body {
            padding: 24px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            background: var(--surface-color);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(30 64 175 / 0.1);
        }

        /* Buttons */
        .button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .button-primary {
            background: var(--primary-color);
            color: white;
        }

        .button-primary:hover {
            background: var(--primary-hover);
        }

        .button-secondary {
            background: var(--background-color);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .button-secondary:hover {
            background: var(--surface-color);
            border-color: var(--text-secondary);
            color: var(--text-primary);
        }

        .button-success {
            background: var(--success-color);
            color: white;
        }

        .button-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* Employee Management */
        .employee-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .employee-input-row {
            display: flex;
            gap: 8px;
            align-items: end;
        }

        .employee-input-row .form-input {
            flex: 1;
        }

        .employee-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .employee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--background-color);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .employee-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .employee-role {
            font-size: 11px;
            color: var(--text-muted);
        }

        .employee-supervisor {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: 600;
            margin-left: 8px;
        }

        .remove-button {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            font-size: 16px;
            line-height: 1;
        }

        .remove-button:hover {
            background: rgb(220 38 38 / 0.1);
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            padding: 12px;
            background: var(--background-color);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1.2;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .employee-stats {
            margin-top: 16px;
        }

        .employee-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .employee-stat:last-child {
            border-bottom: none;
        }

        .employee-stat-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .employee-stat-hours {
            text-align: right;
        }

        .hours-total {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .hours-details {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Calendar */
        .calendar-container {
            min-height: 600px;
        }

        .fc-event {
            border: none !important;
            border-radius: 4px !important;
            font-size: 11px !important;
            font-weight: 500 !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö –∏ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –¥–Ω–µ–π –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ */
        .fc-day-sat .fc-daygrid-day-number,
        .fc-day-sun .fc-daygrid-day-number {
            color: #dc2626 !important;
            font-weight: 700 !important;
        }

        .fc-day-sat .fc-daygrid-day-frame,
        .fc-day-sun .fc-daygrid-day-frame {
            background: rgba(220, 38, 38, 0.05) !important;
        }

        /* –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ */
        .fc-day[data-holiday="true"] .fc-daygrid-day-number {
            color: #dc2626 !important;
            font-weight: 700 !important;
            background: rgba(220, 38, 38, 0.1);
            border-radius: 4px;
            padding: 2px 4px;
        }

        .fc-day[data-holiday="true"] .fc-daygrid-day-frame {
            background: rgba(220, 38, 38, 0.08) !important;
        }

        /* –ü—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ */
        .fc-day[data-pre-holiday="true"] .fc-daygrid-day-number {
            color: #d97706 !important;
            font-weight: 700 !important;
            background: rgba(217, 119, 6, 0.1);
            border-radius: 4px;
            padding: 2px 4px;
        }

        .fc-day[data-pre-holiday="true"] .fc-daygrid-day-frame {
            background: rgba(217, 119, 6, 0.05) !important;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            position: relative;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            min-width: max-content;
        }

        .schedule-table th {
            background: var(--background-color);
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .schedule-table th:first-child {
            position: sticky;
            left: 0;
            z-index: 20;
            background: var(--surface-color);
            border-right: 2px solid var(--border-color);
        }

        .schedule-table td {
            padding: 8px 6px;
            border: 1px solid var(--border-color);
            vertical-align: middle;
            text-align: center;
        }

        .schedule-table td:first-child {
            position: sticky;
            left: 0;
            background: var(--surface-color);
            border-right: 2px solid var(--border-color);
            text-align: left;
            white-space: nowrap;
            font-weight: 600;
            min-width: 200px;
        }

        .schedule-table tr:nth-child(even) {
            background: rgb(248 250 252 / 0.5);
        }

        .schedule-table tr:hover {
            background: var(--background-color);
        }

        .schedule-table tr:hover td:first-child {
            background: var(--background-color);
        }

        /* Shift Colors */
        .shift-day { background: rgb(16 185 129 / 0.1); border-left: 3px solid #10b981; }
        .shift-weekend { background: rgb(245 158 11 / 0.1); border-left: 3px solid #f59e0b; }
        .shift-off { background: rgb(220 38 38 / 0.05); border-left: 3px solid #e5e7eb; }
        .shift-monday-home { background: rgb(139 92 246 / 0.1); border-left: 3px solid #8b5cf6; }
        .shift-monday-duty-home { background: rgb(6 182 212 / 0.1); border-left: 3px solid #06b6d4; }
        .shift-duty-home { background: rgb(168 85 247 / 0.1); border-left: 3px solid #a855f7; }
        .shift-friday { background: rgb(5 150 105 / 0.1); border-left: 3px solid #059669; }
        .shift-pre-holiday { background: rgb(251 191 36 / 0.1); border-left: 3px solid #fbbf24; }
        .shift-supervisor-day { background: rgb(55 65 81 / 0.1); border-left: 3px solid #374151; }
        .shift-supervisor-friday { background: rgb(55 65 81 / 0.1); border-left: 3px solid #374151; }
        .shift-supervisor-pre-holiday { background: rgb(251 191 36 / 0.1); border-left: 3px solid #fbbf24; }

        /* Messages */
        .message {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
            font-weight: 500;
        }

        .message-success {
            background: rgb(5 150 105 / 0.1);
            color: var(--success-color);
            border: 1px solid rgb(5 150 105 / 0.2);
        }

        .message-error {
            background: rgb(220 38 38 / 0.1);
            color: var(--danger-color);
            border: 1px solid rgb(220 38 38 / 0.2);
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 60px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 16px;
            }

            .sidebar {
                position: relative;
                top: auto;
            }

            .content-header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .month-navigation {
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
            }

            .main-container {
                padding: 12px;
                gap: 12px;
            }

            .sidebar-section,
            .content-body {
                padding: 16px;
            }

            .content-header {
                padding: 16px;
            }

            .current-month {
                font-size: 16px;
                min-width: auto;
            }

            .view-tabs {
                width: 100%;
            }

            .tab {
                flex: 1;
                text-align: center;
            }

            .schedule-table {
                font-size: 11px;
            }

            .schedule-table th,
            .schedule-table td {
                padding: 6px 4px;
            }
        }

        /* Hidden elements */
        .hidden {
            display: none !important;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è */
        .detailed-stats {
            margin-top: 12px;
        }

        .stat-grid-detailed {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }

        .stat-mini {
            padding: 6px;
            background: var(--background-color);
            border-radius: 4px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-mini-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .stat-mini-label {
            font-size: 9px;
            color: var(--text-muted);
            margin-top: 1px;
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –ø–æ–∂–µ–ª–∞–Ω–∏–π */
        .preferences-section {
            margin-top: 16px;
        }

        .preference-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: var(--background-color);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            margin-bottom: 8px;
            font-size: 13px;
        }

        .preference-content {
            flex: 1;
        }

        .preference-employee {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .preference-dates {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .preference-type {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            color: white;
            display: inline-block;
        }

        .preference-vacation { background: #ef4444; }
        .preference-no-weekend { background: #f59e0b; }
        .preference-remote-work { background: #8b5cf6; }

        .add-preference-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 12px;
            padding: 12px;
            background: var(--background-color);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            max-width: 100%;
            overflow: hidden;
        }

        .form-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        @media (min-width: 1200px) {
            .form-row {
                flex-direction: row;
                align-items: end;
            }
        }

        .form-group-inline {
            flex: 1;
            min-width: 0;
        }

        .form-group-inline label {
            display: block;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 3px;
        }

        .form-select-sm, .form-input-sm {
            width: 100%;
            padding: 5px 7px;
            font-size: 11px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--surface-color);
            box-sizing: border-box;
        }

        .form-select-sm:focus, .form-input-sm:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgb(30 64 175 / 0.1);
        }

        .date-range-inputs {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-range-inputs input {
            flex: 1;
            min-width: 100px;
        }

        .date-separator {
            font-size: 11px;
            color: var(--text-muted);
        }

        .button-sm {
            padding: 5px 10px;
            font-size: 11px;
            white-space: nowrap;
            margin-top: auto;
        }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –ª–µ–≥–µ–Ω–¥–∞ —Ü–≤–µ—Ç–æ–≤ */
        .shift-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 6px;
            margin-top: 12px;
            padding: 12px;
            background: var(--background-color);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            border: 1px solid var(--border-color);
        }

        /* –í–∞–∫–∞–Ω—Å–∏–∏ */
        .vacation-badge {
            background: #ef4444;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 500;
        }

        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ —Ç–∞–±–ª–∏—Ü—ã */
        .shift-vacation { 
            background: rgb(239 68 68 / 0.1); 
            border-left: 3px solid #ef4444; 
            color: #ef4444;
            font-weight: 600;
        }

        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ */
        .schedule-management {
            display: flex;
            flex-direction: column;
        }

        .saved-schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: var(--background-color);
            border-radius: 4px;
            border: 1px solid var(--border-color);
            margin-bottom: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: var(--transition);
        }

        .saved-schedule-item:hover {
            background: var(--surface-color);
            border-color: var(--primary-color);
        }

        .saved-schedule-info {
            flex: 1;
        }

        .saved-schedule-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .saved-schedule-date {
            color: var(--text-muted);
            font-size: 10px;
        }

        /* Version Info */
        .version-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .version-badge {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .version-details {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Changes Section */
        .changes-list {
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .change-item {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .change-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.1);
        }

        .change-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .change-icon {
            font-size: 16px;
        }

        .change-employee {
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .change-date {
            font-size: 12px;
            color: var(--text-secondary);
            background: var(--background-color);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .change-details {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            margin-left: 24px;
        }

        .change-old {
            background: #fef2f2;
            color: #dc2626;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #fecaca;
        }

        .change-arrow {
            color: var(--text-secondary);
            font-weight: bold;
        }

        .change-new {
            background: #f0fdf4;
            color: #16a34a;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #bbf7d0;
        }

        .change-reason {
            font-size: 11px;
            color: var(--text-muted);
            margin-left: 24px;
            margin-top: 4px;
            font-style: italic;
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø–æ —Ç–∏–ø–∞–º –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .change-added {
            border-left: 4px solid #16a34a;
        }

        .change-removed {
            border-left: 4px solid #dc2626;
        }

        .change-modified {
            border-left: 4px solid #f59e0b;
        }

        /* Versions Section */
        .versions-list {
            max-height: 120px;
            overflow-y: auto;
            margin-bottom: 8px;
            display: none;
        }

        .version-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: var(--background-color);
            border-radius: 4px;
            border: 1px solid var(--border-color);
            margin-bottom: 4px;
            font-size: 11px;
        }

        .version-item.current {
            border-color: var(--primary-color);
            background: rgba(30, 64, 175, 0.05);
        }

        .version-info {
            flex: 1;
        }

        .version-number {
            font-weight: 600;
            color: var(--text-primary);
        }

        .version-date {
            color: var(--text-muted);
            font-size: 10px;
        }

        .version-actions {
            display: flex;
            gap: 4px;
        }

        .version-btn {
            background: none;
            border: none;
            padding: 2px 4px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .version-btn.load {
            color: var(--primary-color);
        }

        .version-btn.load:hover {
            background: rgba(30, 64, 175, 0.1);
        }

        .version-btn.delete {
            color: var(--danger-color);
        }

        .version-btn.delete:hover {
            background: rgba(220, 38, 38, 0.1);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">üìÖ –ì—Ä–∞—Ñ–∏–∫ –°–£–†–í</a>
            <div class="header-actions">
                <button class="button button-primary" id="generateBtn">
                    ‚ö° –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫
                </button>
                <button class="button button-secondary" id="regenerateBtn" style="display: none;">
                    üîÑ –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button class="button button-success hidden" id="downloadBtn">
                    üì• –°–∫–∞—á–∞—Ç—å Excel
                </button>
                <button class="button button-secondary" id="logoutBtn" style="margin-left: 16px;">
                    üö™ –í—ã–π—Ç–∏
                </button>
            </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
            <div class="sidebar-section">
                <h3 class="section-title">‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                <div class="form-group">
                    <label class="form-label" for="year">–ì–æ–¥</label>
                    <select class="form-select" id="year">
                        <option value="2025" selected>2025</option>
                        <option value="2024">2024</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="month">–ú–µ—Å—è—Ü</label>
                    <select class="form-select" id="month">
                        <option value="1">–Ø–Ω–≤–∞—Ä—å</option>
                        <option value="2">–§–µ–≤—Ä–∞–ª—å</option>
                        <option value="3">–ú–∞—Ä—Ç</option>
                        <option value="4">–ê–ø—Ä–µ–ª—å</option>
                        <option value="5">–ú–∞–π</option>
                        <option value="6" selected>–ò—é–Ω—å</option>
                        <option value="7">–ò—é–ª—å</option>
                        <option value="8">–ê–≤–≥—É—Å—Ç</option>
                        <option value="9">–°–µ–Ω—Ç—è–±—Ä—å</option>
                        <option value="10">–û–∫—Ç—è–±—Ä—å</option>
                        <option value="11">–ù–æ—è–±—Ä—å</option>
                        <option value="12">–î–µ–∫–∞–±—Ä—å</option>
                    </select>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ -->
            <div class="sidebar-section">
                <h3 class="section-title">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h3>
                <div class="employee-section">
                    <div class="employee-input-row">
                        <input type="text" class="form-input" id="newEmployeeName" placeholder="–ò–º—è –§–∞–º–∏–ª–∏—è">
                        <button class="button button-secondary button-sm" id="addEmployeeBtn">+</button>
                    </div>
                    
                    <div class="form-group" style="margin-top: 12px;">
                        <label class="form-label" for="supervisorSelect">–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</label>
                        <select class="form-select" id="supervisorSelect">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è</option>
                        </select>
                    </div>
                    
                    <div class="employee-list" id="employeeList">
                        <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>

            <!-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
            <div class="sidebar-section">
                <h3 class="section-title">üíæ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏</h3>
                <div class="schedule-management">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏ -->
                    <div id="versionInfo" class="version-info" style="display: none;">
                        <div class="version-badge">
                            <span id="currentVersion">v1</span>
                        </div>
                        <div class="version-details" id="versionDetails">
                            <!-- –î–µ—Ç–∞–ª–∏ –≤–µ—Ä—Å–∏–∏ -->
                        </div>
                    </div>
                    
                    <!-- –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
                    <div id="changesSection" style="display: none;">
                        <h4 style="margin: 12px 0 8px 0; font-size: 14px; color: var(--primary-color);">üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è:</h4>
                        <div id="changesList" class="changes-list">
                            <!-- –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
                        </div>
                    </div>
                    
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ -->
                    <div id="versionsSection" style="display: none;">
                        <h4 style="margin: 12px 0 8px 0; font-size: 14px; color: var(--primary-color);">üìö –í–µ—Ä—Å–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞:</h4>
                        <div id="versionsList" class="versions-list">
                            <!-- –°–ø–∏—Å–æ–∫ –≤–µ—Ä—Å–∏–π -->
                        </div>
                        <button class="button button-secondary button-sm" id="showVersionsBtn" style="width: 100%; margin-top: 8px;" onclick="toggleVersionsList()">
                            üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏
                        </button>
                    </div>
                    
                    <button class="button button-secondary button-sm" id="loadScheduleBtn" style="width: 100%; margin-bottom: 8px;">
                        üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
                    </button>
                    
                    <button class="button button-secondary button-sm" id="deleteMonthBtn" style="width: 100%; margin-bottom: 8px; color: var(--danger-color); border-color: var(--danger-color);">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –º–µ—Å—è—á–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
                    </button>
                    
                    <div id="savedSchedulesList" style="max-height: 120px; overflow-y: auto; margin-top: 8px;">
                        <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
                    </div>
                </div>
            </div>

            <!-- –ü–æ–∂–µ–ª–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
            <div class="sidebar-section">
                <h3 class="section-title">üìã –ü–æ–∂–µ–ª–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
                <div class="preferences-section">
                    <div id="preferencesList">
                        <!-- –°–ø–∏—Å–æ–∫ –ø–æ–∂–µ–ª–∞–Ω–∏–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    
                    <div class="add-preference-form">
                        <div class="form-row">
                            <div class="form-group-inline">
                                <label for="prefEmployee">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
                                <select class="form-select-sm" id="prefEmployee">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</option>
                                </select>
                            </div>
                            <div class="form-group-inline">
                                <label for="prefType">–¢–∏–ø –ø–æ–∂–µ–ª–∞–Ω–∏—è</label>
                                <select class="form-select-sm" id="prefType">
                                    <option value="vacation">–û—Ç–ø—É—Å–∫</option>
                                    <option value="no_weekend">–ù–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ</option>
                                    <option value="remote_work">–£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group-inline">
                                <label>–ü–µ—Ä–∏–æ–¥</label>
                                <div class="date-range-inputs">
                                    <input type="date" class="form-input-sm" id="prefStartDate">
                                    <span class="date-separator">‚Äî</span>
                                    <input type="date" class="form-input-sm" id="prefEndDate">
                                </div>
                            </div>
                            <button class="button button-primary button-sm" id="addPreferenceBtn">
                                ‚úì –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                        
                        <div class="form-group-inline">
                            <label for="prefReason">–ü—Ä–∏—á–∏–Ω–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="text" class="form-input-sm" id="prefReason" placeholder="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É...">
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="sidebar-section hidden" id="statisticsSection">
                <h3 class="section-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="targetHours">-</div>
                        <div class="stat-label">–ù–æ—Ä–º–∞ —á–∞—Å–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalEmployees">-</div>
                        <div class="stat-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                    </div>
                </div>
                
                <div class="employee-stats" id="employeeStats">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º -->
                </div>

                <!-- –õ–µ–≥–µ–Ω–¥–∞ —Ü–≤–µ—Ç–æ–≤ —Å–º–µ–Ω -->
                <div class="shift-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #10b981;"></div>
                        <span>–î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #8b5cf6;"></div>
                        <span>–ü–Ω –∏–∑ –¥–æ–º–∞</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #06b6d4;"></div>
                        <span>–ü–Ω –¥–µ–∂—É—Ä—Å—Ç–≤–æ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #a855f7;"></div>
                        <span>–î–µ–∂—É—Ä—Å—Ç–≤–æ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f59e0b;"></div>
                        <span>–í—ã—Ö–æ–¥–Ω—ã–µ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #059669;"></div>
                        <span>–ü—è—Ç–Ω–∏—Ü–∞</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ef4444;"></div>
                        <span>–û—Ç–ø—É—Å–∫</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #374151;"></div>
                        <span>–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</span>
                    </div>
                </div>
            </div>
        </aside>

        <main class="content">
            <div class="content-header">
                <div class="month-navigation">
                    <button class="nav-button" onclick="changeMonth(-1)">‚Äπ</button>
                    <span class="current-month" id="currentMonth">–ò—é–Ω—å 2025</span>
                    <button class="nav-button" onclick="changeMonth(1)">‚Ä∫</button>
                </div>
                <div class="view-tabs">
                    <button class="tab active" id="calendarTab" onclick="showView('calendar')">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
                    <button class="tab" id="tableTab" onclick="showView('table')">üìã –¢–∞–±–ª–∏—Ü–∞</button>
                </div>
            </div>

            <div class="content-body">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏...</p>
                </div>

                <div id="messages"></div>

                <div class="calendar-container hidden" id="calendarContainer">
                    <div id="calendar"></div>
                </div>

                <div class="table-container hidden" id="tableContainer">
                    <div id="scheduleTable"></div>
                </div>

                <div id="welcomeMessage" class="text-center" style="padding: 60px; color: var(--text-muted);">
                    <h2 style="margin-bottom: 12px; color: var(--text-secondary);">üéØ –°–∏—Å—Ç–µ–º–∞ –°–£–†–í v2.0</h2>
                    <p style="margin-bottom: 20px;">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ —Å —É—á–µ—Ç–æ–º –ø–æ–∂–µ–ª–∞–Ω–∏–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
                    
                    <div style="text-align: left; max-width: 600px; margin: 0 auto; background: var(--background-color); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 12px; color: var(--primary-color);">‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</h3>
                        <ul style="margin-bottom: 16px; line-height: 1.8;">
                            <li><strong>–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</strong> - –∞–ª–≥–æ—Ä–∏—Ç–º —É—á–∏—Ç—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å —Å–º–µ–Ω –º–µ–∂–¥—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</li>
                            <li><strong>–ü–æ–∂–µ–ª–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</strong> - –æ—Ç–ø—É—Å–∫–∞, –∏–∑–±–µ–≥–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω—ã—Ö, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∫–∏</li>
                            <li><strong>–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong> - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ–Ω –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞, –º–∞–∫—Å–∏–º—É–º –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</li>
                            <li><strong>–¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞</strong> - –≤ Excel —Ñ–∞–π–ª–µ —Å –ª–µ–≥–µ–Ω–¥–æ–π —Ç–∏–ø–æ–≤ —Å–º–µ–Ω</li>
                            <li><strong>–î–µ–º–æ –ø–æ–∂–µ–ª–∞–Ω–∏—è</strong> - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π</li>
                        </ul>
                        
                        <h3 style="margin-bottom: 12px; color: var(--primary-color);">‚úÖ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:</h3>
                        <ol style="line-height: 1.8;">
                            <li>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (8 —á–µ–ª–æ–≤–µ–∫ –º–∏–Ω–∏–º—É–º)</li>
                            <li>–î–æ–±–∞–≤—å—Ç–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</li>
                            <li>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫"</li>
                            <li>–ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —Å–∫–∞—á–∞–π—Ç–µ Excel —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π</li>
                        </ol>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // === –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ===
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async function() {
            await checkAuthStatus();
            initializeApp();
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function checkAuthStatus() {
            try {
                const response = await fetch('/api/auth-status');
                const result = await response.json();
                
                if (!result.authenticated) {
                    // –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞
                    window.location.href = '/login.html';
                    return;
                }
                
                // –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
                document.getElementById('logoutBtn').addEventListener('click', logout);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —Ç–æ–∂–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–≥–∏–Ω
                window.location.href = '/login.html';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        async function logout() {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞
                    window.location.href = '/login.html';
                } else {
                    showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
                // –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–≥–∏–Ω
                window.location.href = '/login.html';
            }
        }

        // === –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ===
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let employees = [];
        let employeeDetails = []; // –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö
        let supervisorName = null;
        let currentData = null;
        let employeePreferences = new Map();
        let calendar = null; // –û–±—ä–µ–∫—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—è FullCalendar

        const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                           '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function initializeApp() {
            document.getElementById('generateBtn').addEventListener('click', generateSchedule);
            document.getElementById('regenerateBtn').addEventListener('click', regenerateSchedule);
            document.getElementById('downloadBtn').addEventListener('click', downloadExcel);
            document.getElementById('addEmployeeBtn').addEventListener('click', addEmployee);
            document.getElementById('addPreferenceBtn').addEventListener('click', addPreference);
            document.getElementById('loadScheduleBtn').addEventListener('click', loadSavedSchedules);
            document.getElementById('deleteMonthBtn').addEventListener('click', deleteEntireMonth);
            document.getElementById('supervisorSelect').addEventListener('change', updateSupervisor);
            document.getElementById('newEmployeeName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addEmployee();
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –ë–î –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
            loadEmployeesFromDatabase();
            loadSavedSchedules();
            
            // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            setTimeout(() => {
                autoLoadCurrentSchedule();
            }, 1000);
        }

        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞/–≥–æ–¥–∞
        async function autoLoadCurrentSchedule() {
            console.log('üîÑ –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞...');
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);
            
            try {
                const response = await fetch(`/api/schedule/${year}/${month}`);
                const data = await response.json();
                
                if (data.success) {
                    console.log('‚úÖ –ì—Ä–∞—Ñ–∏–∫ –Ω–∞–π–¥–µ–Ω –≤ –ë–î:', data);
                    currentData = data;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
                    console.log('üìù –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞:', data.employees);
                    employees = data.employees;
                    if (employees.length > 0) {
                        supervisorName = employees[0]; // –ü–µ—Ä–≤—ã–π –≤ —Å–ø–∏—Å–∫–µ - —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
                    }
                    
                    updateSupervisorSelect();
                    updateEmployeeList();
                    updatePreferencesEmployeeList();
                    updateMonthDisplay(year, month);
                    displayResults(data);
                    
                    document.getElementById('downloadBtn').classList.remove('hidden');
                    document.getElementById('statisticsSection').classList.remove('hidden');
                    document.getElementById('generateBtn').style.display = 'none';
                    document.getElementById('regenerateBtn').style.display = 'inline-flex';
                    document.getElementById('welcomeMessage').style.display = 'none';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏
                    displayVersionInfo(data);
                    
                    showView('calendar');
                    showMessage(`–ì—Ä–∞—Ñ–∏–∫ ${monthNames[month-1]} ${year} –∑–∞–≥—Ä—É–∂–µ–Ω (–≤–µ—Ä—Å–∏—è ${data.version || 1})`, 'success');
                } else {
                    console.log('‚ùå –ì—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î');
                }
            } catch (error) {
                // –ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                console.log('üì≠ –ì—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:', error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞
        async function regenerateSchedule() {
            if (employees.length < 8) {
                showMessage('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –º–∏–Ω–∏–º—É–º 8 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞', 'error');
                return;
            }

            if (!supervisorName || !employees.includes(supervisorName)) {
                showMessage('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', 'error');
                return;
            }

            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–∂–µ–ª–∞–Ω–∏—è—Ö
            const preferencesData = {};
            let hasPreferences = false;
            
            console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∂–µ–ª–∞–Ω–∏–π...');
            console.log('üìä employeePreferences:', employeePreferences);
            
            employeePreferences.forEach((empPrefs, employee) => {
                console.log(`üë§ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: ${employee}`);
                console.log(`üìã –ï–≥–æ –ø–æ–∂–µ–ª–∞–Ω–∏—è:`, empPrefs);
                
                preferencesData[employee] = {};
                
                empPrefs.forEach((pref, key) => {
                    console.log(`üîë –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–∂–µ–ª–∞–Ω–∏–µ —Å –∫–ª—é—á–æ–º: ${key}`, pref);
                    hasPreferences = true;
                    const startDate = new Date(pref.startDate);
                    const endDate = new Date(pref.endDate);
                    
                    console.log(`üìÖ –ü–µ—Ä–∏–æ–¥: ${pref.startDate} - ${pref.endDate}`);
                    console.log(`üîß –¢–∏–ø: ${pref.type}`);
                    
                    for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                        const dateKey = d.toISOString().split('T')[0];
                        preferencesData[employee][dateKey] = {
                            type: pref.type,
                            reason: pref.reasonText || pref.reason
                        };
                        console.log(`üìÜ –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∞—Ç–∞: ${dateKey} –¥–ª—è ${employee}, —Ç–∏–ø: ${pref.type}`);
                    }
                });
            });

            console.log('‚úÖ –ò—Ç–æ–≥–æ–≤—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', JSON.stringify(preferencesData, null, 2));
            console.log('üìä –ï—Å—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è:', hasPreferences);

            // –ï—Å–ª–∏ –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø–æ–∂–µ–ª–∞–Ω–∏—è—Ö, —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            if (!hasPreferences && currentData) {
                if (!confirm('–ü–æ–∂–µ–ª–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫? –≠—Ç–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.')) {
                    return;
                }
            }

            // –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –ø–µ—Ä–≤—ã–º
            const orderedEmployees = [supervisorName, ...employees.filter(emp => emp !== supervisorName)];

            document.getElementById('loading').style.display = 'block';
            document.getElementById('changesSection').style.display = 'none';

            try {
                const requestBody = {
                    year,
                    month,
                    customNames: orderedEmployees,
                    preferences: preferencesData,
                    regenerate: true // –§–ª–∞–≥ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                };
                
                console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', JSON.stringify(requestBody, null, 2));

                const response = await fetch('/api/generate-schedule', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                console.log('üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);

                if (data.success) {
                    currentData = data;
                    currentFilename = data.filename;
                    
                    updateMonthDisplay(year, month);
                    displayResults(data);
                    displayVersionInfo(data);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å
                    console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π...');
                    console.log('üìä data.changesDescription:', data.changesDescription);
                    console.log('üìä data.minimalChanges:', data.minimalChanges);
                    console.log('üìä data.isMinimalChange:', data.isMinimalChange);
                    
                    if (data.changesDescription) {
                        console.log('üìù –ù–∞–π–¥–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:', data.changesDescription);
                        displayChanges(data.changesDescription);
                    } else if (data.minimalChanges && data.minimalChanges.length > 0) {
                        console.log('üìù –ù–∞–π–¥–µ–Ω—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ...', data.minimalChanges);
                        // –ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–æ—Å—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                        const formatMinimalChanges = (changes) => {
                            const employeeChanges = {};
                            changes.forEach(change => {
                                if (!employeeChanges[change.employee]) {
                                    employeeChanges[change.employee] = [];
                                }
                                const date = new Date(change.date).toLocaleDateString('ru-RU');
                                const oldShiftText = change.oldShift.type === 'OFF' ? '–í—ã—Ö–æ–¥–Ω–æ–π' : 
                                                   `${change.oldShift.start || ''}-${change.oldShift.end || ''}${change.oldShift.hours ? ` (${change.oldShift.hours}—á)` : ''}`;
                                const newShiftText = change.newShift.type === 'OFF' ? '–í—ã—Ö–æ–¥–Ω–æ–π' : 
                                                   change.newShift.type === 'vacation' ? '–û—Ç–ø—É—Å–∫' :
                                                   `${change.newShift.start || ''}-${change.newShift.end || ''}${change.newShift.hours ? ` (${change.newShift.hours}—á)` : ''}`;
                                
                                employeeChanges[change.employee].push({
                                    date,
                                    oldShift: oldShiftText,
                                    newShift: newShiftText,
                                    reason: change.reason
                                });
                            });
                            return employeeChanges;
                        };
                        
                        const changesDescription = formatMinimalChanges(data.minimalChanges);
                        displayChanges(changesDescription);
                    } else {
                        console.log('‚ùå –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                        // –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
                        document.getElementById('changesSection').style.display = 'none';
                    }
                    
                    showMessage(`–ì—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω! –°–æ–∑–¥–∞–Ω–∞ –≤–µ—Ä—Å–∏—è ${data.version}`, 'success');
                    document.getElementById('downloadBtn').classList.remove('hidden');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
                    await loadSavedSchedules();
                    
                    showView('calendar');
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞');
                }
            } catch (error) {
                showMessage(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–µ—Ä—Å–∏–∏
        function displayVersionInfo(data) {
            const versionInfo = document.getElementById('versionInfo');
            const currentVersion = document.getElementById('currentVersion');
            const versionDetails = document.getElementById('versionDetails');
            const versionsSection = document.getElementById('versionsSection');
            
            if (data.version) {
                currentVersion.textContent = `v${data.version}`;
                
                let detailsText = '';
                if (data.parentVersion) {
                    detailsText = `(–æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å v${data.parentVersion})`;
                } else {
                    detailsText = '(–ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è)';
                }
                
                versionDetails.textContent = detailsText;
                versionInfo.style.display = 'flex';
                versionsSection.style.display = 'block';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤–µ—Ä—Å–∏–π
                loadVersionsList(data.year, data.month, data.version);
            } else {
                versionInfo.style.display = 'none';
                versionsSection.style.display = 'none';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≤–µ—Ä—Å–∏–π
        async function loadVersionsList(year, month, currentVersion) {
            try {
                const response = await fetch(`/api/schedule-versions/${year}/${month}`);
                const data = await response.json();
                
                if (data.success) {
                    displayVersionsList(data.versions, currentVersion);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ—Ä—Å–∏–π:', error);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–µ—Ä—Å–∏–π
        function displayVersionsList(versions, currentVersion) {
            const versionsList = document.getElementById('versionsList');
            versionsList.innerHTML = '';
            
            if (versions.length === 0) {
                versionsList.innerHTML = '<p style="color: var(--text-muted); font-size: 11px; text-align: center; padding: 8px;">–ù–µ—Ç –≤–µ—Ä—Å–∏–π</p>';
                return;
            }
            
            versions.forEach(version => {
                const item = document.createElement('div');
                item.className = `version-item ${version.version === currentVersion ? 'current' : ''}`;
                
                const dateStr = new Date(version.createdAt).toLocaleDateString('ru-RU', {
                    day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit'
                });
                
                item.innerHTML = `
                    <div class="version-info">
                        <div class="version-number">–í–µ—Ä—Å–∏—è ${version.version}</div>
                        <div class="version-date">${dateStr}</div>
                    </div>
                    <div class="version-actions">
                        ${version.version !== currentVersion ? 
                            `<button class="version-btn load" onclick="loadVersion(${version.id})" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å">üì•</button>` : 
                            '<span style="color: var(--success-color); font-size: 10px;">–¢–µ–∫—É—â–∞—è</span>'
                        }
                        ${!(versions.length === 1 && version.version === 1) ? 
                            `<button class="version-btn delete" onclick="deleteVersion(${version.id}, ${version.version})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>` : 
                            ''
                        }
                    </div>
                `;
                versionsList.appendChild(item);
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å–ø–∏—Å–∫–∞ –≤–µ—Ä—Å–∏–π
        function toggleVersionsList() {
            const versionsList = document.getElementById('versionsList');
            const showBtn = document.getElementById('showVersionsBtn');
            
            if (versionsList.style.display === 'none' || !versionsList.style.display) {
                versionsList.style.display = 'block';
                showBtn.textContent = 'üìö –°–∫—Ä—ã—Ç—å –≤–µ—Ä—Å–∏–∏';
            } else {
                versionsList.style.display = 'none';
                showBtn.textContent = 'üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
        async function loadVersion(scheduleId) {
            try {
                document.getElementById('loading').style.display = 'block';
                
                const response = await fetch(`/api/schedule/id/${scheduleId}`);
                const data = await response.json();
                
                if (data.success) {
                    currentData = data;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('year').value = data.year;
                    document.getElementById('month').value = data.month;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
                    employees = data.employees;
                    if (employees.length > 0) {
                        supervisorName = employees[0];
                    }
                    
                    updateSupervisorSelect();
                    updateEmployeeList();
                    updatePreferencesEmployeeList();
                    updateMonthDisplay(data.year, data.month);
                    displayResults(data);
                    displayVersionInfo(data);
                    
                    document.getElementById('downloadBtn').classList.remove('hidden');
                    document.getElementById('statisticsSection').classList.remove('hidden');
                    
                    showView('calendar');
                    showMessage(`–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –≤–µ—Ä—Å–∏—è ${data.version} –≥—Ä–∞—Ñ–∏–∫–∞`, 'success');
                } else {
                    showMessage('–ì—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–µ—Ä—Å–∏–∏: ' + error.message, 'error');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞
        async function deleteVersion(scheduleId, version) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–µ—Ä—Å–∏—é ${version}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/schedule/${scheduleId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message, 'success');
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤–µ—Ä—Å–∏–π
                    if (currentData) {
                        loadVersionsList(currentData.year, currentData.month, currentData.version);
                    }
                } else {
                    showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏: ' + error.message, 'error');
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π –≥—Ä–∞—Ñ–∏–∫–æ–≤
        // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—á–µ—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        function displayChanges(changesDescription) {
            const changesSection = document.getElementById('changesSection');
            const changesList = document.getElementById('changesList');
            
            changesList.innerHTML = '';
            
            let hasRealChanges = false;
            
            Object.entries(changesDescription).forEach(([employee, changes]) => {
                changes.forEach(change => {
                    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–µ "–í—ã—Ö–æ–¥–Ω–æ–π ‚Üí –í—ã—Ö–æ–¥–Ω–æ–π")
                    const isRealChange = change.oldShift !== change.newShift;
                    
                    if (isRealChange) {
                        hasRealChanges = true;
                        const changeItem = document.createElement('div');
                        changeItem.className = 'change-item';
                        
                        // –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø—É –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        let changeClass = '';
                        let changeIcon = '';
                        
                        if (change.newShift === '–í—ã—Ö–æ–¥–Ω–æ–π') {
                            changeClass = 'change-removed';
                            changeIcon = 'üî¥';
                        } else if (change.oldShift === '–í—ã—Ö–æ–¥–Ω–æ–π') {
                            changeClass = 'change-added';
                            changeIcon = 'üü¢';
                        } else {
                            changeClass = 'change-modified';
                            changeIcon = 'üîÑ';
                        }
                        
                        changeItem.className += ` ${changeClass}`;
                        
                        changeItem.innerHTML = `
                            <div class="change-header">
                                <span class="change-icon">${changeIcon}</span>
                                <div class="change-employee">${employee}</div>
                                <div class="change-date">${change.date}</div>
                            </div>
                            <div class="change-details">
                                <span class="change-old">${change.oldShift}</span> 
                                <span class="change-arrow">‚Üí</span> 
                                <span class="change-new">${change.newShift}</span>
                            </div>
                            ${change.reason ? `<div class="change-reason">${change.reason}</div>` : ''}
                        `;
                        
                        changesList.appendChild(changeItem);
                    }
                });
            });
            
            if (hasRealChanges) {
                changesSection.style.display = 'block';
            } else {
                changesSection.style.display = 'none';
                console.log('üì≠ –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å -> –Ω–æ—á–Ω—ã–µ –¥–µ–∂—É—Ä–Ω—ã–µ -> –æ—Å—Ç–∞–ª—å–Ω—ã–µ
        function organizeEmployees(employees, scheduleData) {
            if (!scheduleData) return employees;

            const supervisor = employees.find(emp => emp === supervisorName);
            const staff = employees.filter(emp => emp !== supervisorName);
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ—á–Ω—ã–µ –¥–µ–∂—É—Ä—Å—Ç–≤–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            const nightDutyCount = {};
            staff.forEach(emp => {
                nightDutyCount[emp] = 0;
                Object.values(scheduleData[emp] || {}).forEach(shift => {
                    if (shift.type === 'DUTY_HOME' || shift.type === 'MONDAY_DUTY_HOME') {
                        nightDutyCount[emp]++;
                    }
                });
            });

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º: –±–æ–ª—å—à–µ –Ω–æ—á–Ω—ã—Ö –¥–µ–∂—É—Ä—Å—Ç–≤ = –≤—ã—à–µ
            const sortedStaff = staff.sort((a, b) => {
                const dutyDiff = nightDutyCount[b] - nightDutyCount[a];
                if (dutyDiff !== 0) return dutyDiff;
                return a.localeCompare(b); // –ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É –µ—Å–ª–∏ —Ä–∞–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            });

            return supervisor ? [supervisor, ...sortedStaff] : sortedStaff;
        }

        function updateSupervisor() {
            const selectedSupervisor = document.getElementById('supervisorSelect').value;
            if (selectedSupervisor) {
                supervisorName = selectedSupervisor;
                updateEmployeeList();
                showMessage(`–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${supervisorName}`, 'success');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function loadEmployeesFromDatabase() {
            console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –ë–î...');
            try {
                const response = await fetch('/api/employees');
                const data = await response.json();
                
                console.log('üìä –û—Ç–≤–µ—Ç –æ—Ç API:', data);
                
                if (data.success && data.employees.length > 0) {
                    employees = data.employees;
                    employeeDetails = data.employeeDetails || []; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    
                    // –ü–µ—Ä–≤—ã–π –≤ —Å–ø–∏—Å–∫–µ - —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
                    supervisorName = employees[0];
                    console.log('üëë –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', supervisorName);
                    
                    updateSupervisorSelect();
                    updateEmployeeList();
                    updatePreferencesEmployeeList();
                    showMessage(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${employees.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö`, 'success');
                } else {
                    // –ï—Å–ª–∏ –≤ –ë–î –Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–æ–∑–¥–∞—Ç—å
                    employees = [];
                    employeeDetails = [];
                    console.log('‚ùå –í –ë–î –Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤');
                    showMessage('–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –î–æ–±–∞–≤—å—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤—Ä—É—á–Ω—É—é.', 'error');
                }
            } catch (error) {
                console.error('üí• –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:', error);
                employees = [];
                employeeDetails = [];
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –ë–î. –î–æ–±–∞–≤—å—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤—Ä—É—á–Ω—É—é.', 'error');
            }
        }

        function updateSupervisorSelect() {
            const select = document.getElementById('supervisorSelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è</option>';
            
            employees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp;
                option.textContent = emp;
                if (emp === supervisorName) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        function addEmployee() {
            const nameInput = document.getElementById('newEmployeeName');
            const name = nameInput.value.trim();
            
            if (!name) return;
            
            if (employees.includes(name)) {
                showMessage('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }
            
            employees.push(name);
            nameInput.value = '';
            
            // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∏–ª–∏ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è, –¥–µ–ª–∞–µ–º –µ–≥–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º
            if (employees.length === 1 || !supervisorName || !employees.includes(supervisorName)) {
                supervisorName = name;
            }
            
            updateSupervisorSelect();
            updateEmployeeList();
            updatePreferencesEmployeeList();
        }

        function removeEmployee(name) {
            employees = employees.filter(emp => emp !== name);
            // –£–¥–∞–ª—è–µ–º –ø–æ–∂–µ–ª–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            employeePreferences.delete(name);
            
            // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è, –Ω–∞–∑–Ω–∞—á–∞–µ–º –Ω–æ–≤–æ–≥–æ
            if (name === supervisorName && employees.length > 0) {
                supervisorName = employees[0];
                updateSupervisorSelect();
            }
            
            updateEmployeeList();
            updatePreferencesEmployeeList();
            updatePreferencesList();
        }

        function autoGenerateEmployees() {
            const firstNames = ['–ê–ª–µ–∫—Å–∞–Ω–¥—Ä', '–ê–Ω–Ω–∞', '–ú–∏—Ö–∞–∏–ª', '–ï–ª–µ–Ω–∞', '–î–º–∏—Ç—Ä–∏–π', '–û–ª—å–≥–∞', '–°–µ—Ä–≥–µ–π', '–¢–∞—Ç—å—è–Ω–∞'];
            const lastNames = ['–ò–≤–∞–Ω–æ–≤', '–ü–µ—Ç—Ä–æ–≤–∞', '–°–∏–¥–æ—Ä–æ–≤', '–ö–æ–∑–ª–æ–≤–∞', '–°–º–∏—Ä–Ω–æ–≤', '–ù–æ–≤–∏–∫–æ–≤–∞', '–õ–µ–±–µ–¥–µ–≤', '–ú–æ—Ä–æ–∑–æ–≤–∞'];
            
            employees = [];
            employeePreferences.clear();
            for (let i = 0; i < 8; i++) {
                employees.push(`${firstNames[i]} ${lastNames[i]}`);
            }
            updateEmployeeList();
            updatePreferencesEmployeeList();
            updatePreferencesList();
        }

        function updateEmployeeList() {
            const listElement = document.getElementById('employeeList');
            listElement.innerHTML = '';
            
            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å -> –Ω–æ—á–Ω—ã–µ –¥–µ–∂—É—Ä–Ω—ã–µ -> –æ—Å—Ç–∞–ª—å–Ω—ã–µ
            let orderedEmployees;
            
            if (currentData && currentData.schedule) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –Ω–æ—á–Ω—ã—Ö —Å–º–µ–Ω
                const supervisor = employees.find(emp => emp === supervisorName);
                const staff = employees.filter(emp => emp !== supervisorName);
                
                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ—á–Ω—ã–µ –¥–µ–∂—É—Ä—Å—Ç–≤–∞
                const nightDutyCount = {};
                staff.forEach(emp => {
                    nightDutyCount[emp] = 0;
                    Object.values(currentData.schedule[emp] || {}).forEach(shift => {
                        if (shift.type === 'DUTY_HOME' || shift.type === 'MONDAY_DUTY_HOME') {
                            nightDutyCount[emp]++;
                        }
                    });
                });

                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –Ω–æ—á–Ω—ã—Ö, –∑–∞—Ç–µ–º –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
                const sortedStaff = staff.sort((a, b) => {
                    const dutyDiff = nightDutyCount[b] - nightDutyCount[a];
                    if (dutyDiff !== 0) return dutyDiff;
                    return a.localeCompare(b, 'ru');
                });

                orderedEmployees = supervisor ? [supervisor, ...sortedStaff] : sortedStaff;
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞, –ø—Ä–æ—Å—Ç–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –ø–µ—Ä–≤—ã–π, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
                const supervisor = employees.find(emp => emp === supervisorName);
                const staff = employees.filter(emp => emp !== supervisorName).sort((a, b) => a.localeCompare(b, 'ru'));
                orderedEmployees = supervisor ? [supervisor, ...staff] : staff;
            }
            
            orderedEmployees.forEach((name) => {
                if (!name || !employees.includes(name)) return;
                
                const item = document.createElement('div');
                item.className = 'employee-item';
                const isSupervisor = name === supervisorName;
                
                // –ò—â–µ–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ
                const employeeDetail = employeeDetails.find(emp => emp.name === name);
                const employmentDate = employeeDetail?.employmentDate ? 
                    new Date(employeeDetail.employmentDate).toLocaleDateString('ru-RU') : 
                    '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
                const position = employeeDetail?.position === 'SUPERVISOR' ? '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –æ—Ç–¥–µ–ª–∞' : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –°–£–†–í';
                
                item.innerHTML = `
                    <div>
                        <div class="employee-name">
                            ${name}
                            ${isSupervisor ? '<span class="employee-supervisor">–†–£–ö–û–í–û–î–ò–¢–ï–õ–¨</span>' : ''}
                        </div>
                        <div class="employee-role">${position}</div>
                        <div class="employee-employment-date" style="font-size: 11px; color: var(--text-muted);">
                            –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã: ${employmentDate}
                        </div>
                    </div>
                    <button class="remove-button" onclick="removeEmployee('${name}')" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                `;
                listElement.appendChild(item);
            });
        }

        function updatePreferencesEmployeeList() {
            const select = document.getElementById('prefEmployee');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</option>';
            
            // –¢–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –°–£–†–í (–∏—Å–∫–ª—é—á–∞–µ–º —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è)
            employees.filter(emp => emp !== supervisorName).forEach(emp => {
                const option = document.createElement('option');
                option.value = emp;
                option.textContent = emp;
                select.appendChild(option);
            });
        }

        function addPreference() {
            const employee = document.getElementById('prefEmployee').value;
            const type = document.getElementById('prefType').value;
            const startDate = document.getElementById('prefStartDate').value;
            const endDate = document.getElementById('prefEndDate').value;
            const reason = document.getElementById('prefReason').value;
            
            if (!employee || !type || !startDate || !endDate) {
                showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–∂–µ–ª–∞–Ω–∏—è', 'error');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç
            if (new Date(startDate) > new Date(endDate)) {
                showMessage('–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è', 'error');
                return;
            }
            
            if (!employeePreferences.has(employee)) {
                employeePreferences.set(employee, new Map());
            }
            
            const typeNames = {
                'vacation': '–û—Ç–ø—É—Å–∫',
                'no_weekend': '–ù–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ',
                'remote_work': '–£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞'
            };

            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞
            const preferenceKey = `${startDate}_${endDate}_${type}`;
            
            employeePreferences.get(employee).set(preferenceKey, {
                type: type,
                startDate: startDate,
                endDate: endDate,
                reason: typeNames[type],
                reasonText: reason || ''
            });
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('prefEmployee').value = '';
            document.getElementById('prefType').value = 'vacation';
            document.getElementById('prefStartDate').value = '';
            document.getElementById('prefEndDate').value = '';
            document.getElementById('prefReason').value = '';
            
            updatePreferencesList();
            showMessage(`–ü–æ–∂–µ–ª–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è ${employee}`, 'success');
        }

        function removePreference(employee, key) {
            if (employeePreferences.has(employee)) {
                employeePreferences.get(employee).delete(key);
                if (employeePreferences.get(employee).size === 0) {
                    employeePreferences.delete(employee);
                }
            }
            updatePreferencesList();
        }

        function updatePreferencesList() {
            const listElement = document.getElementById('preferencesList');
            listElement.innerHTML = '';
            
            let hasPreferences = false;
            
            employeePreferences.forEach((empPrefs, employee) => {
                empPrefs.forEach((pref, key) => {
                    hasPreferences = true;
                    const item = document.createElement('div');
                    item.className = 'preference-item';
                    
                    const startDate = new Date(pref.startDate).toLocaleDateString('ru-RU');
                    const endDate = new Date(pref.endDate).toLocaleDateString('ru-RU');
                    const dateRange = startDate === endDate ? startDate : `${startDate} ‚Äî ${endDate}`;
                    
                    const typeClass = `preference-${pref.type.replace('_', '-')}`;
                    
                    item.innerHTML = `
                        <div class="preference-content">
                            <div class="preference-employee">${employee.split(' ')[0]} ${employee.split(' ')[1]}</div>
                            <div class="preference-dates">${dateRange}</div>
                            <span class="preference-type ${typeClass}">${pref.reason}</span>
                            ${pref.reasonText ? `<div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">${pref.reasonText}</div>` : ''}
                        </div>
                        <button class="remove-button" onclick="removePreference('${employee}', '${key}')" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                    `;
                    listElement.appendChild(item);
                });
            });
            
            if (!hasPreferences) {
                listElement.innerHTML = '<p style="color: var(--text-muted); font-size: 12px; text-align: center; padding: 16px;">–ü–æ–∂–µ–ª–∞–Ω–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏—è –¥–∞—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω –ø–æ–∂–µ–ª–∞–Ω–∏–π
        function isDateInPreferenceRange(employee, date, preferenceType) {
            if (!employeePreferences.has(employee)) return false;
            
            const empPrefs = employeePreferences.get(employee);
            for (const [key, pref] of empPrefs) {
                if (pref.type === preferenceType || !preferenceType) {
                    const checkDate = new Date(date);
                    const startDate = new Date(pref.startDate);
                    const endDate = new Date(pref.endDate);
                    
                    if (checkDate >= startDate && checkDate <= endDate) {
                        return true;
                    }
                }
            }
            return false;
        }

        function showMessage(text, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            const message = document.createElement('div');
            message.className = `message message-${type}`;
            message.textContent = text;
            messagesDiv.innerHTML = '';
            messagesDiv.appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 5000);
        }

        function showView(viewName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±—ã
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(viewName + 'Tab').classList.add('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
            document.getElementById('calendarContainer').classList.add('hidden');
            document.getElementById('tableContainer').classList.add('hidden');
            document.getElementById(viewName + 'Container').classList.remove('hidden');
            
            if (viewName === 'calendar' && calendar) {
                setTimeout(() => calendar.render(), 100);
            }
        }

        function changeMonth(direction) {
            if (!currentData) return;
            
            let year = parseInt(currentData.year);
            let month = parseInt(currentData.month);
            
            month += direction;
            if (month > 12) {
                month = 1;
                year++;
            } else if (month < 1) {
                month = 12;
                year--;
            }
            
            document.getElementById('year').value = year;
            document.getElementById('month').value = month;
            generateSchedule();
        }

        async function generateSchedule() {
            if (employees.length < 8) {
                showMessage('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –º–∏–Ω–∏–º—É–º 8 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞', 'error');
                return;
            }

            if (!supervisorName || !employees.includes(supervisorName)) {
                showMessage('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', 'error');
                return;
            }

            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);

            // –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –ø–µ—Ä–≤—ã–º
            const orderedEmployees = [supervisorName, ...employees.filter(emp => emp !== supervisorName)];

            document.getElementById('loading').style.display = 'block';

            try {
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø–æ–∂–µ–ª–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
                const preferencesData = {};
                employeePreferences.forEach((empPrefs, employee) => {
                    preferencesData[employee] = {};
                    
                    empPrefs.forEach((pref, key) => {
                        const startDate = new Date(pref.startDate);
                        const endDate = new Date(pref.endDate);
                        
                        for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                            const dateKey = d.toISOString().split('T')[0];
                            preferencesData[employee][dateKey] = {
                                type: pref.type,
                                reason: pref.reasonText || pref.reason
                            };
                        }
                    });
                });

                const response = await fetch('/api/generate-schedule', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        year,
                        month,
                        customNames: orderedEmployees,
                        preferences: preferencesData,
                        regenerate: false // –û–±—ã—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
                    })
                });

                const data = await response.json();

                if (data.success) {
                    currentData = data;
                    currentFilename = data.filename;
                    
                    updateMonthDisplay(year, month);
                    displayResults(data);
                    
                    showMessage('–ì—Ä–∞—Ñ–∏–∫ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!');
                    document.getElementById('downloadBtn').classList.remove('hidden');
                    document.getElementById('statisticsSection').classList.remove('hidden');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
                    await loadSavedSchedules();
                    
                    showView('calendar');
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞');
                }
            } catch (error) {
                showMessage(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function updateMonthDisplay(year, month) {
            document.getElementById('currentMonth').textContent = `${monthNames[month - 1]} ${year}`;
        }

        function displayResults(data) {
            const { schedule, employeeHours, targetHours, employees, detailedStats } = data;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            displayStatistics(data);
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            renderCalendar(data);
            
            // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            renderTable(data);
        }

        function displayStatistics(data) {
            const { schedule, employeeHours, targetHours, employees, detailedStats } = data;
            
            document.getElementById('targetHours').textContent = targetHours + '—á';
            document.getElementById('totalEmployees').textContent = employees.length;
            
            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å -> –±–æ–ª—å—à–µ –Ω–æ—á–Ω—ã—Ö -> –º–µ–Ω—å—à–µ –Ω–æ—á–Ω—ã—Ö -> –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
            const supervisor = employees.find(emp => emp === supervisorName);
            const staff = employees.filter(emp => emp !== supervisorName);
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ—á–Ω—ã–µ –¥–µ–∂—É—Ä—Å—Ç–≤–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            const nightDutyCount = {};
            staff.forEach(emp => {
                nightDutyCount[emp] = 0;
                Object.values(schedule[emp] || {}).forEach(shift => {
                    if (shift.type === 'DUTY_HOME' || shift.type === 'MONDAY_DUTY_HOME') {
                        nightDutyCount[emp]++;
                    }
                });
            });

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º: –±–æ–ª—å—à–µ –Ω–æ—á–Ω—ã—Ö –¥–µ–∂—É—Ä—Å—Ç–≤ = –≤—ã—à–µ, –∑–∞—Ç–µ–º –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
            const sortedStaff = staff.sort((a, b) => {
                const dutyDiff = nightDutyCount[b] - nightDutyCount[a];
                if (dutyDiff !== 0) return dutyDiff;
                return a.localeCompare(b, 'ru');
            });

            const orderedEmployees = supervisor ? [supervisor, ...sortedStaff] : sortedStaff;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º
            const employeeStatsHtml = orderedEmployees.map((emp) => {
                const totalHours = employeeHours[emp] || 0;
                const isSupervisor = emp === supervisorName;
                
                if (isSupervisor) {
                    // –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å - —Ç–æ–ª—å–∫–æ —á–∞—Å—ã
                    const workDays = Object.values(schedule[emp] || {}).filter(shift => shift.type !== 'OFF').length;
                    const offDays = Object.values(schedule[emp] || {}).filter(shift => shift.type === 'OFF').length;
                    
                    return `
                        <div class="employee-stat">
                            <div class="employee-stat-name">${emp} <span class="employee-supervisor">–†–£–ö–û–í–û–î–ò–¢–ï–õ–¨</span></div>
                            <div class="employee-stat-hours">
                                <div class="hours-total">${totalHours}—á</div>
                                <div class="hours-details">–†–∞–±: ${workDays} | –í—ã—Ö: ${offDays} | –ù–æ—á–Ω: 0</div>
                            </div>
                        </div>
                    `;
                } else {
                    // –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –°–£–†–í - –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    const stats = detailedStats[emp] || {};
                    const nightShifts = nightDutyCount[emp] || 0;
                    
                    return `
                        <div class="employee-stat">
                            <div class="employee-stat-name">${emp}</div>
                            <div class="employee-stat-hours">
                                <div class="hours-total">${totalHours}—á</div>
                                <div class="detailed-stats">
                                    <div class="stat-grid-detailed">
                                        <div class="stat-mini">
                                            <div class="stat-mini-value">${stats.workDays || 0}</div>
                                            <div class="stat-mini-label">–†–∞–±. –¥–Ω.</div>
                                        </div>
                                        <div class="stat-mini">
                                            <div class="stat-mini-value">${stats.offDays || 0}</div>
                                            <div class="stat-mini-label">–í—ã—Ö–æ–¥–Ω—ã—Ö</div>
                                        </div>
                                        <div class="stat-mini">
                                            <div class="stat-mini-value">${nightShifts}</div>
                                            <div class="stat-mini-label">–ù–æ—á–Ω—ã—Ö</div>
                                        </div>
                                        <div class="stat-mini">
                                            <div class="stat-mini-value">${stats.weekendShifts || 0}</div>
                                            <div class="stat-mini-label">–í—ã—Ö–æ–¥–Ω. —Å–º.</div>
                                        </div>
                                        <div class="stat-mini">
                                            <div class="stat-mini-value">${stats.maxConsecutiveWork || 0}</div>
                                            <div class="stat-mini-label">–ú–∞–∫—Å. –ø–æ–¥—Ä—è–¥</div>
                                        </div>
                                        <div class="stat-mini">
                                            <div class="stat-mini-value">${stats.vacationDays || 0}</div>
                                            <div class="stat-mini-label">–û—Ç–ø—É—Å–∫</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
            
            document.getElementById('employeeStats').innerHTML = employeeStatsHtml;
        }

        function renderCalendar(data) {
            const { schedule, employees } = data;
            
            if (calendar && typeof calendar.destroy === 'function') {
                calendar.destroy();
            }
            
            const events = [];
            const shiftColors = {
                'DAY': '#10b981',
                'MONDAY_HOME': '#8b5cf6',
                'MONDAY_DUTY_HOME': '#06b6d4',
                'DUTY_HOME': '#a855f7',
                'FRIDAY': '#059669',
                'WEEKEND': '#f59e0b',
                'PRE_HOLIDAY': '#fbbf24',
                'SUPERVISOR_DAY': '#374151',
                'SUPERVISOR_FRIDAY': '#374151',
                'SUPERVISOR_PRE_HOLIDAY': '#fbbf24',
                'vacation': '#ef4444'
            };
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
            const getEventPriority = (shift, emp) => {
                // –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å - —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1)
                if (emp === supervisorName) return 1;
                
                // –ù–æ—á–Ω—ã–µ —Å–º–µ–Ω—ã - –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (2)
                if (shift.type === 'DUTY_HOME' || shift.type === 'MONDAY_DUTY_HOME') return 2;
                
                // –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–º–µ–Ω—ã - —Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (3)
                if (shift.type === 'MONDAY_HOME' || shift.type === 'WEEKEND' || shift.type === 'vacation') return 3;
                
                // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–º–µ–Ω—ã - –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (4)
                return 4;
            };
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
            const allEvents = [];
            Object.keys(schedule).forEach(emp => {
                Object.entries(schedule[emp]).forEach(([date, shift]) => {
                    if (shift.type !== 'OFF') {
                        let title = '';
                        
                        if (shift.type === 'vacation') {
                            title = `${emp.split(' ')[0]} | –û–¢–ü–£–°–ö`;
                        } else {
                            const locationText = shift.location === '–¥–æ–º' ? ' (–¥–æ–º)' : '';
                            title = `${emp.split(' ')[0]} | ${shift.start}-${shift.end}${locationText}`;
                        }
                        
                        allEvents.push({
                            title: title,
                            start: date,
                            backgroundColor: shiftColors[shift.type] || '#6b7280',
                            borderColor: shiftColors[shift.type] || '#6b7280',
                            textColor: 'white',
                            priority: getEventPriority(shift, emp),
                            employee: emp,
                            shiftType: shift.type
                        });
                    }
                });
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –ø–æ –¥–∞—Ç–µ, –∑–∞—Ç–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É, –∑–∞—Ç–µ–º –ø–æ –∏–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            allEvents.sort((a, b) => {
                // –°–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ
                const dateCompare = a.start.localeCompare(b.start);
                if (dateCompare !== 0) return dateCompare;
                
                // –ó–∞—Ç–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–º–µ–Ω—å—à–µ = –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                const priorityCompare = a.priority - b.priority;
                if (priorityCompare !== 0) return priorityCompare;
                
                // –ó–∞—Ç–µ–º –ø–æ –∏–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                return a.employee.localeCompare(b.employee, 'ru');
            });

            calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
                initialView: 'dayGridMonth',
                locale: 'ru',
                firstDay: 1, // –ù–∞—á–∏–Ω–∞–µ–º —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
                initialDate: `${data.year}-${String(data.month).padStart(2, '0')}-01`,
                height: 'auto',
                events: allEvents,
                headerToolbar: false,
                dayMaxEvents: 6, // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö —Å–æ–±—ã—Ç–∏–π
                eventDisplay: 'block',
                eventTextColor: 'white',
                eventOrder: 'priority,employee', // –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π
                didMount: function() {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –¥–Ω–µ–π –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞
                    markSpecialDays(data.year, data.month);
                }
            });
            
            calendar.render();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –∏ –ø—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –¥–Ω–µ–π
        function markSpecialDays(year, month) {
            const { holidays, preHolidays } = getSpecialDays(year, month);
            
            // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            setTimeout(() => {
                // –û—Ç–º–µ—á–∞–µ–º –ø—Ä–∞–∑–¥–Ω–∏–∫–∏
                Object.keys(holidays).forEach(dateStr => {
                    const [y, m, d] = dateStr.split('-');
                    
                    // –ò—â–µ–º —è—á–µ–π–∫—É –¥–Ω—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                    const daySelectors = [
                        `[data-date="${dateStr}"]`,
                        `.fc-day[data-date="${dateStr}"]`,
                        `.fc-daygrid-day[data-date="${dateStr}"]`,
                        `td[data-date="${dateStr}"]`
                    ];
                    
                    let dayElement = null;
                    for (const selector of daySelectors) {
                        dayElement = document.querySelector(selector);
                        if (dayElement) break;
                    }
                    
                    if (dayElement) {
                        dayElement.setAttribute('data-holiday', 'true');
                        dayElement.title = holidays[dateStr];
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
                        const dayNumber = dayElement.querySelector('.fc-daygrid-day-number');
                        const dayFrame = dayElement.querySelector('.fc-daygrid-day-frame');
                        
                        if (dayNumber) {
                            dayNumber.style.color = '#dc2626';
                            dayNumber.style.fontWeight = '700';
                            dayNumber.style.background = 'rgba(220, 38, 38, 0.1)';
                            dayNumber.style.borderRadius = '4px';
                            dayNumber.style.padding = '2px 4px';
                        }
                        
                        if (dayFrame) {
                            dayFrame.style.background = 'rgba(220, 38, 38, 0.08)';
                        }
                    }
                });
                
                // –û—Ç–º–µ—á–∞–µ–º –ø—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏
                Object.keys(preHolidays).forEach(dateStr => {
                    const [y, m, d] = dateStr.split('-');
                    
                    const daySelectors = [
                        `[data-date="${dateStr}"]`,
                        `.fc-day[data-date="${dateStr}"]`,
                        `.fc-daygrid-day[data-date="${dateStr}"]`,
                        `td[data-date="${dateStr}"]`
                    ];
                    
                    let dayElement = null;
                    for (const selector of daySelectors) {
                        dayElement = document.querySelector(selector);
                        if (dayElement) break;
                    }
                    
                    if (dayElement) {
                        dayElement.setAttribute('data-pre-holiday', 'true');
                        dayElement.title = preHolidays[dateStr];
                        
                        const dayNumber = dayElement.querySelector('.fc-daygrid-day-number');
                        const dayFrame = dayElement.querySelector('.fc-daygrid-day-frame');
                        
                        if (dayNumber) {
                            dayNumber.style.color = '#d97706';
                            dayNumber.style.fontWeight = '700';
                            dayNumber.style.background = 'rgba(217, 119, 6, 0.1)';
                            dayNumber.style.borderRadius = '4px';
                            dayNumber.style.padding = '2px 4px';
                        }
                        
                        if (dayFrame) {
                            dayFrame.style.background = 'rgba(217, 119, 6, 0.05)';
                        }
                    }
                });
            }, 100);
        }

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –∏ –ø—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –¥–Ω–µ–π
        function getSpecialDays(year, month) {
            const holidays = {};
            const preHolidays = {};
            
            // –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ 2025 –≥–æ–¥–∞ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å —Å–µ—Ä–≤–µ—Ä–æ–º)
            if (year === 2025) {
                const allHolidays = {
                    '2025-01-01': '–ù–æ–≤—ã–π –≥–æ–¥',
                    '2025-01-02': '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã',
                    '2025-01-03': '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã',
                    '2025-01-04': '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã',
                    '2025-01-05': '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã',
                    '2025-01-06': '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã',
                    '2025-01-07': '–†–æ–∂–¥–µ—Å—Ç–≤–æ –•—Ä–∏—Å—Ç–æ–≤–æ',
                    '2025-01-08': '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∫–∞–Ω–∏–∫—É–ª—ã',
                    '2025-02-23': '–î–µ–Ω—å –∑–∞—â–∏—Ç–Ω–∏–∫–∞ –û—Ç–µ—á–µ—Å—Ç–≤–∞',
                    '2025-03-08': '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –∂–µ–Ω—Å–∫–∏–π –¥–µ–Ω—å',
                    '2025-05-01': '–ü—Ä–∞–∑–¥–Ω–∏–∫ –í–µ—Å–Ω—ã –∏ –¢—Ä—É–¥–∞',
                    '2025-05-02': '–ü—Ä–∞–∑–¥–Ω–∏–∫ –í–µ—Å–Ω—ã –∏ –¢—Ä—É–¥–∞ (–ø–µ—Ä–µ–Ω–æ—Å)',
                    '2025-05-09': '–î–µ–Ω—å –ü–æ–±–µ–¥—ã',
                    '2025-06-12': '–î–µ–Ω—å –†–æ—Å—Å–∏–∏',
                    '2025-06-13': '–î–µ–Ω—å –†–æ—Å—Å–∏–∏ (–ø–µ—Ä–µ–Ω–æ—Å)',
                    '2025-11-04': '–î–µ–Ω—å –Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–∞',
                    '2025-12-31': '–ù–æ–≤—ã–π –≥–æ–¥ (–ø—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å)'
                };
                
                const allPreHolidays = {
                    '2025-02-22': '–ü—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å',
                    '2025-03-07': '–ü—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å',
                    '2025-04-30': '–ü—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å',
                    '2025-05-08': '–ü—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å',
                    '2025-06-11': '–ü—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å',
                    '2025-11-03': '–ü—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å',
                    '2025-12-30': '–ü—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å'
                };
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –º–µ—Å—è—Ü—É
                Object.keys(allHolidays).forEach(date => {
                    const dateMonth = parseInt(date.split('-')[1]);
                    if (dateMonth === month) {
                        holidays[date] = allHolidays[date];
                    }
                });
                
                Object.keys(allPreHolidays).forEach(date => {
                    const dateMonth = parseInt(date.split('-')[1]);
                    if (dateMonth === month) {
                        preHolidays[date] = allPreHolidays[date];
                    }
                });
            }
            
            return { holidays, preHolidays };
        }

        function renderTable(data) {
            const { schedule, employees } = data;
            const daysInMonth = new Date(parseInt(data.year), parseInt(data.month), 0).getDate();
            const weekdays = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
            
            // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∞–∑–¥–Ω–∏–∫–∏ –∏ –ø—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            const { holidays, preHolidays } = getSpecialDays(parseInt(data.year), parseInt(data.month));

            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å -> –Ω–æ—á–Ω—ã–µ –¥–µ–∂—É—Ä–Ω—ã–µ -> –æ—Å—Ç–∞–ª—å–Ω—ã–µ
            const supervisor = employees.find(emp => emp === supervisorName);
            const staff = employees.filter(emp => emp !== supervisorName);
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ—á–Ω—ã–µ –¥–µ–∂—É—Ä—Å—Ç–≤–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            const nightDutyCount = {};
            staff.forEach(emp => {
                nightDutyCount[emp] = 0;
                Object.values(schedule[emp] || {}).forEach(shift => {
                    if (shift.type === 'DUTY_HOME' || shift.type === 'MONDAY_DUTY_HOME') {
                        nightDutyCount[emp]++;
                    }
                });
            });

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º: –±–æ–ª—å—à–µ –Ω–æ—á–Ω—ã—Ö –¥–µ–∂—É—Ä—Å—Ç–≤ = –≤—ã—à–µ, –∑–∞—Ç–µ–º –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
            const sortedStaff = staff.sort((a, b) => {
                const dutyDiff = nightDutyCount[b] - nightDutyCount[a];
                if (dutyDiff !== 0) return dutyDiff;
                return a.localeCompare(b, 'ru');
            });

            const orderedEmployees = supervisor ? [supervisor, ...sortedStaff] : sortedStaff;

            let tableHtml = `
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th rowspan="2" style="vertical-align: middle;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
            `;

            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–∞—Ç
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(parseInt(data.year), parseInt(data.month) - 1, day);
                const dateStr = `${data.year}-${String(data.month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayOfWeek = weekdays[date.getDay()];
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                const isHoliday = holidays[dateStr];
                const isPreHoliday = preHolidays[dateStr];
                
                let bgColor = '';
                if (isHoliday) {
                    bgColor = 'background: rgb(220 38 38 / 0.1);'; // –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤
                } else if (isPreHoliday) {
                    bgColor = 'background: rgb(251 191 36 / 0.1);'; // –ñ–µ–ª—Ç—ã–π –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö
                } else if (isWeekend) {
                    bgColor = 'background: rgb(220 38 38 / 0.05);'; // –°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö
                }
                
                tableHtml += `<th style="min-width: 80px; ${bgColor}" title="${isHoliday || isPreHoliday || ''}">${String(day).padStart(2, '0')}</th>`;
            }
            
            tableHtml += `</tr><tr>`;
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(parseInt(data.year), parseInt(data.month) - 1, day);
                const dateStr = `${data.year}-${String(data.month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayOfWeek = weekdays[date.getDay()];
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                const isHoliday = holidays[dateStr];
                const isPreHoliday = preHolidays[dateStr];
                
                let bgColor = '';
                let textColor = '';
                if (isHoliday) {
                    bgColor = 'background: rgb(220 38 38 / 0.1);';
                    textColor = 'color: #dc2626; font-weight: 600;';
                } else if (isPreHoliday) {
                    bgColor = 'background: rgb(251 191 36 / 0.1);';
                    textColor = 'color: #d97706; font-weight: 600;';
                } else if (isWeekend) {
                    bgColor = 'background: rgb(220 38 38 / 0.05);';
                    textColor = 'color: #dc2626;';
                }
                
                tableHtml += `<th style="font-size: 11px; ${bgColor} ${textColor}">${dayOfWeek}</th>`;
            }
            
            tableHtml += `</tr></thead><tbody>`;

            // –°—Ç—Ä–æ–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
            orderedEmployees.forEach((emp) => {
                tableHtml += `<tr>`;
                
                // –ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                const isSupervisor = emp === supervisorName;
                const role = isSupervisor ? ' <span class="employee-supervisor">–†–£–ö–û–í–û–î–ò–¢–ï–õ–¨</span>' : '';
                tableHtml += `<td style="font-weight: 600; position: sticky; left: 0; background: var(--surface-color); border-right: 2px solid var(--border-color);">
                    ${emp}${role}
                </td>`;

                // –°–º–µ–Ω—ã –ø–æ –¥–Ω—è–º
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${data.year}-${String(data.month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const shift = schedule[emp][dateStr];
                    const date = new Date(parseInt(data.year), parseInt(data.month) - 1, day);
                    const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                    const isHoliday = holidays[dateStr];
                    const isPreHoliday = preHolidays[dateStr];
                    
                    let cellContent = '';
                    let cellClass = '';
                    let bgColor = '';

                    if (shift) {
                        if (shift.type === 'OFF') {
                            cellContent = '‚Äî';
                            cellClass = 'shift-off';
                        } else if (shift.type === 'vacation') {
                            cellContent = '<span class="vacation-badge">–û–¢–ü–£–°–ö</span>';
                            cellClass = 'shift-vacation';
                        } else {
                            const locationText = shift.location === '–¥–æ–º' ? ' (–¥–æ–º)' : '';
                            cellContent = `${shift.start}<br>${shift.end}${locationText}<br><small>${shift.hours}—á</small>`;
                            cellClass = `shift-${shift.type.toLowerCase().replace('_', '-')}`;
                        }
                    }

                    // –§–æ–Ω–æ–≤—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ—Å–æ–±—ã—Ö –¥–Ω–µ–π
                    if (isHoliday) {
                        bgColor = 'background: rgb(220 38 38 / 0.02);';
                    } else if (isPreHoliday) {
                        bgColor = 'background: rgb(251 191 36 / 0.02);';
                    } else if (isWeekend) {
                        bgColor = 'background: rgb(220 38 38 / 0.01);';
                    }

                    tableHtml += `<td class="${cellClass}" style="text-align: center; font-size: 11px; ${bgColor}">${cellContent}</td>`;
                }

                tableHtml += '</tr>';
            });

            tableHtml += '</tbody></table>';
            document.getElementById('scheduleTable').innerHTML = tableHtml;
        }

        async function downloadExcel() {
            if (!currentFilename) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫', 'error');
                return;
            }

            try {
                const response = await fetch(`/api/download/${currentFilename}`);
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = currentFilename;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    showMessage('–§–∞–π–ª Excel —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω!');
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
                }
            } catch (error) {
                showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏: ${error.message}`, 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        async function saveCurrentSchedule() {
            if (!currentData) {
                showMessage('–ù–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
                return;
            }

            try {
                // –ì—Ä–∞—Ñ–∏–∫ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                await loadSavedSchedules();
                showMessage('–ì—Ä–∞—Ñ–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö', 'success');
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞: ' + error.message, 'error');
            }
        }

        async function loadSavedSchedules() {
            try {
                const response = await fetch('/api/schedules');
                const data = await response.json();
                
                if (data.success) {
                    displaySavedSchedules(data.schedules);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤:', error);
            }
        }

        function displaySavedSchedules(schedules) {
            const listElement = document.getElementById('savedSchedulesList');
            listElement.innerHTML = '';
            
            if (schedules.length === 0) {
                listElement.innerHTML = '<p style="color: var(--text-muted); font-size: 11px; text-align: center; padding: 8px;">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤</p>';
                return;
            }
            
            schedules.slice(0, 5).forEach(schedule => {
                const item = document.createElement('div');
                item.className = 'saved-schedule-item';
                item.onclick = () => loadScheduleById(schedule.year, schedule.month);
                
                const monthName = monthNames[schedule.month - 1];
                const dateStr = new Date(schedule.createdAt).toLocaleDateString('ru-RU');
                
                item.innerHTML = `
                    <div class="saved-schedule-info">
                        <div class="saved-schedule-title">${monthName} ${schedule.year}</div>
                        <div class="saved-schedule-date">–°–æ–∑–¥–∞–Ω: ${dateStr}</div>
                    </div>
                `;
                listElement.appendChild(item);
            });
        }

        async function loadScheduleById(year, month) {
            try {
                document.getElementById('loading').style.display = 'block';
                
                const response = await fetch(`/api/schedule/${year}/${month}`);
                const data = await response.json();
                
                if (data.success) {
                    currentData = data;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('year').value = year;
                    document.getElementById('month').value = month;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
                    employees = data.employees;
                    if (employees.length > 0) {
                        supervisorName = employees[0]; // –ü–µ—Ä–≤—ã–π –≤ —Å–ø–∏—Å–∫–µ - —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å
                    }
                    
                    updateSupervisorSelect();
                    updateEmployeeList();
                    updatePreferencesEmployeeList();
                    updateMonthDisplay(year, month);
                    displayResults(data);
                    
                    document.getElementById('downloadBtn').classList.remove('hidden');
                    document.getElementById('statisticsSection').classList.remove('hidden');
                    
                    showView('calendar');
                    showMessage(`–ì—Ä–∞—Ñ–∏–∫ ${monthNames[month-1]} ${year} –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö`, 'success');
                } else {
                    showMessage('–ì—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞: ' + error.message, 'error');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function deleteEntireMonth() {
            if (!currentData) {
                showMessage('–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                return;
            }
            
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –≤–µ—Ä—Å–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ ${monthNames[currentData.month-1]} ${currentData.year}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`)) {
                return;
            }

            try {
                const response = await fetch(`/api/delete-month/${currentData.year}/${currentData.month}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message, 'success');
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                    currentData = null;
                    currentFilename = null;
                    
                    document.getElementById('downloadBtn').classList.add('hidden');
                    document.getElementById('statisticsSection').classList.add('hidden');
                    document.getElementById('generateBtn').style.display = 'inline-flex';
                    document.getElementById('regenerateBtn').style.display = 'none';
                    document.getElementById('welcomeMessage').style.display = 'block';
                    document.getElementById('calendarContainer').classList.add('hidden');
                    document.getElementById('tableContainer').classList.add('hidden');
                    
                    // –û—á–∏—â–∞–µ–º —Å–µ–∫—Ü–∏–∏ –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç–∏
                    document.getElementById('versionInfo').style.display = 'none';
                    document.getElementById('changesSection').style.display = 'none';
                    document.getElementById('versionsSection').style.display = 'none';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
                    await loadSavedSchedules();
                } else {
                    showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
